mailapp_init () 
{ 
    comment http://hints.macworld.com/article.php?story=20081217161612647
    [[ -d tpostfix ]] && rm -fr tpostfix
    echo  mail_setup ${1:-tpostfix}
}
maillib_init () 
{ 
    .  programlib 2> /dev/null;
    mailapp_init
}

mail_smtp() 
{
   comment you can use smtp.yourisp.com:port, such as smtp.yourisp.com:587;
   comment tls_loglevel = 2 is optional if you want to see what is going on with the TLS negotiation in /var/log/mail.log
   touch main.cf
   grep smtp_use_tls main.cf && return

mail_ids || { comment failed ISP, USER, PWD; popd; return; }

cat <<EOF >> main.cf
relayhost = $ISP
smtp_sasl_auth_enable = yes
smtp_use_tls = yes
smtp_enforce_tls = yes
smtp_sasl_security_options =
smtp_sasl_tls_security_options =
smtp_sasl_tls_verified_security_options =
smtp_tls_loglevel = 2
smtp_sasl_password_maps = hash:/etc/postfix/smtp_sasl_passwords
smtp_tls_per_site = hash:/etc/postfix/smtp_tls_sites
tls_random_source = dev:/dev/urandom
EOF
}
mail_ids  ()
{
   [[ "$ISP" = "" ]] && { mail_User-Pwd-Server; }
   [[ "$USERNAME" = "" ]] && {  mail_User-Pwd-Server; }
   [[ "$PASSWORD" = "" ]] && {  mail_User-Pwd-Server; }

   echo $ISP $USERNAME:$PASSWORD > smtp_sasl_passwords
   echo $ISP MUST_NOPEERMATCH > smtp_tls_sites    
}
mail_User-Pwd-Server ()
{
   comment  'mail_User-Pwd-Server ENTRY'

   read    -p 'ISP? '       ISP;      export ISP
   read    -p 'USEERNAME? ' USERNAME; export USERNAME
   read -s -p 'PASSWORD? '  PASSWORD; export PASSWORD
}
mail_setup ()
{
   set -- $(needir ${1:-/etc/postfix})

   mail_User-Pwd-Server

   pushd $1
   mail_smtp

   chmod go-rx smtp_sasl_passwords
   postmap smtp_sasl_passwords
   postmap smtp_tls_sites
   ls -lrt 
   pwd
   popd
}
maillib_init
